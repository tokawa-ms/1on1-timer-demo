# 1 on 1 タイマーアプリケーション - 仕様書

## 概要

Azure Speech Service の Speaker Diarization（話者分離）機能を使用して、1 on 1 ミーティングにおけるマネージャーと部下の発話時間を計測・可視化するアプリケーションです。

## 目的

- マネージャーと部下の発話時間のバランスを可視化
- マネージャーに対して適切なフィードバックを提供
- より効果的な 1 on 1 ミーティングの実現をサポート

## 技術スタック

### フロントエンド
- HTML5（UTF-8エンコーディング）
- CSS3 with Tailwind CSS（CDN）
- JavaScript ES6

### 外部ライブラリ
- **Azure Speech SDK**: 音声認識と話者分離
  - CDN: `https://cdn.jsdelivr.net/npm/microsoft-cognitiveservices-speech-sdk@latest/distrib/browser/microsoft.cognitiveservices.speech.sdk.bundle.js`
- **Chart.js**: グラフ描画
  - CDN: `https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js`
- **Tailwind CSS**: UIフレームワーク
  - CDN: `https://cdn.tailwindcss.com`

## 機能仕様

### 1. Azure Speech Service 接続設定（画面上部）

#### 入力項目
- **リージョン**: Azure Speech Service のリージョン（例: japaneast）
- **サブスクリプションキー**: Azure Portal から取得したアクセスキー

#### 機能
- 「接続テスト & 保存」ボタンで API への接続テストを実行
- 接続成功時、リージョンとキーをブラウザーのローカルストレージに保存
- 次回起動時に保存された設定を自動読み込み

### 2. 録音コントロール

#### ボタン
- **録音開始**: マイクから音声入力を開始し、Speaker Diarization を実行
- **録音停止**: 音声入力を停止

#### 動作
- 録音中はリアルタイムで話者を分離し、発話内容を認識
- 各話者の発話時間を自動計測

### 3. 話者選択（画面左側）

#### 表示内容
- 検出された全話者をリスト表示
- 各話者の累計発話時間を表示

#### 機能
- チェックボックスでマネージャーに該当する話者を選択
- マネージャー選択状態に応じて統計を再計算

### 4. 発話時間比率グラフ（画面左側）

#### グラフタイプ
- ドーナツグラフ（Chart.js）

#### 表示内容
- マネージャーの発話時間と比率（青色）
- 部下の発話時間と比率（緑色）

#### 統計表示
- マネージャーの累計発話時間（MM:SS形式）
- 部下の累計発話時間（MM:SS形式）
- それぞれの比率（パーセンテージ）

### 5. アドバイス表示（画面左側）

#### 表示条件と内容

| マネージャー発話比率 | アドバイス内容 |
|---------------------|---------------|
| 70%超 | ⚠️ マネージャーの発話時間が多すぎます。もっと部下の話を聞くようにしましょう。1on1では部下が主役です。 |
| 30%未満 | 💡 マネージャーの発話時間が少なすぎます。もっといろいろな話をして、部下をサポートしましょう。 |
| 30%〜70% | ✅ 良いバランスです！このまま対話を続けましょう。 |

### 6. 会話履歴（画面右側）

#### 表示形式
- チャット UI 形式で会話を時系列に表示
- マネージャーと部下を視覚的に区別

#### 表示内容
- 話者アイコン（M: マネージャー、S: 部下）
- 話者名と役割
- 発話内容（テキスト）
- 発話時刻

#### 色分け
- マネージャー: 青系（`bg-blue-100`, `border-blue-500`）
- 部下: 緑系（`bg-green-100`, `border-green-500`）

## データ管理

### ローカルストレージ
以下の項目をブラウザーのローカルストレージに保存：
- `speechRegion`: Azure Speech Service のリージョン
- `speechKey`: サブスクリプションキー

### メモリ管理
以下のデータを JavaScript のメモリ上で管理：
- 話者情報（Map形式）
  - 話者ID
  - 話者名
  - 累計発話時間
  - 発話セグメント（テキスト、時間、タイムスタンプ）
  - マネージャーフラグ
- マネージャーとして選択された話者IDのセット

## レスポンシブデザイン

### ブレイクポイント
- **モバイル**: 〜768px
  - 1カラムレイアウト
- **タブレット/デスクトップ**: 768px〜
  - 2カラムレイアウト（左: 統計、右: 会話履歴）

### レイアウト調整
- 画面外周に十分なマージンを設定
- 要素が画面外にはみ出さないように制御
- スクロール可能な会話履歴エリア

## エラーハンドリング

### 接続エラー
- リージョンまたはキーが無効な場合、エラーメッセージを表示
- コンソールに詳細なエラー情報を出力

### 認識エラー
- Azure Speech Service のエラーをキャッチし、ユーザーに通知
- エラーコードとエラー詳細をコンソールログに出力

### マイクアクセスエラー
- マイクへのアクセスが拒否された場合、適切なメッセージを表示

## ログ出力

### コンソールログレベル
- `console.log`: 通常の情報（初期化、状態変化、データ更新）
- `console.warn`: 警告（予期しない状態、リソース不足）
- `console.error`: エラー（例外、API エラー、接続失敗）

### 主要なログ出力ポイント
- アプリケーション起動時
- DOM要素の取得完了時
- 設定保存と接続テスト
- 録音開始/停止
- 話者検出
- 音声認識結果
- セッション開始/停止
- エラー発生時

## セキュリティ考慮事項

### APIキーの取り扱い
- ハードコーディング禁止
- UI入力フィールドから設定
- ローカルストレージに保存（デモ用途のため）
- 本番環境では、バックエンドAPIを経由する設計を推奨

### 注意事項
このアプリケーションは技術デモ用のサンプルであり、本番環境での使用には以下の対応が必要：
- APIキーをバックエンドで管理
- HTTPS通信の必須化
- 認証・認可の実装

## ブラウザー要件

### 対応ブラウザー
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 必要な機能
- Web Speech API サポート
- マイクへのアクセス許可
- LocalStorage サポート
- ES6 サポート

## 使用方法

### セットアップ手順

1. **Azure Speech Service の準備**
   - Azure Portal で Speech Service リソースを作成
   - リージョンとサブスクリプションキーを取得

2. **アプリケーションの起動**
   - ブラウザーで `src/index.html` を開く

3. **接続設定**
   - リージョン（例: japaneast）を入力
   - サブスクリプションキーを入力
   - 「接続テスト & 保存」ボタンをクリック

4. **1 on 1 ミーティングの録音**
   - 「録音開始」ボタンをクリック
   - マイクへのアクセスを許可
   - 1 on 1 ミーティングを実施

5. **話者の選択**
   - 検出された話者の中から、マネージャーに該当する話者を選択

6. **結果の確認**
   - 発話時間比率グラフを確認
   - アドバイスを参照
   - 会話履歴を確認

7. **録音の停止**
   - 「録音停止」ボタンをクリック

## 今後の拡張案

- 録音データのエクスポート機能（JSON, CSV）
- 発話時間の推移グラフ（時系列）
- 複数セッションの比較機能
- 感情分析の追加
- 会話のサマリー生成（AI活用）
- レポート機能
